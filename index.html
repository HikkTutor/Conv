<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Litematica Converter</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nbt-js@1.5.0/nbt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/litematic-js@1.0.0/dist/litematic.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
        }

        :root {
            --mc-green: #4a785e;
            --mc-dark: #0c342d;
            --mc-light: #2ecc71;
            --mc-border: #3d6b52;
            --mc-error: #e74c3c;
            --mc-gold: #f1c40f;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: var(--mc-dark) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23187e5e"/><path d="M0 0L100 100M100 0L0 100" stroke="%23155c43" stroke-width="1"/></svg>');
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(13, 43, 34, 0.9);
            border: 6px solid var(--mc-green);
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7), inset 0 0 10px rgba(0, 0, 0, 0.5);
            padding: 30px;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--mc-border);
        }

        h1 {
            color: var(--mc-light);
            text-shadow: 3px 3px 0 #27ae60, 5px 5px 0 rgba(0, 0, 0, 0.5);
            font-size: 2.2rem;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #bdc3c7;
            font-size: 0.8rem;
            margin: 5px 0;
        }

        .converter-box {
            background: rgba(10, 30, 24, 0.7);
            border: 4px solid var(--mc-border);
            border-radius: 4px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 4px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            background: rgba(25, 100, 80, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-area.active {
            background: rgba(46, 204, 113, 0.3);
            border-color: var(--mc-light);
        }

        .upload-area.error {
            border-color: var(--mc-error);
            background: rgba(231, 76, 60, 0.2);
        }

        .format-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .format-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 15px;
            border: 3px solid var(--mc-border);
            border-radius: 4px;
            background: rgba(15, 50, 40, 0.5);
            transition: all 0.3s ease;
            width: 140px;
        }

        .format-option.selected {
            border-color: var(--mc-light);
            background: rgba(46, 204, 113, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .format-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .convert-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: inherit;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s ease;
            box-shadow: 0 5px 0 #219653;
            position: relative;
            overflow: hidden;
        }

        .convert-btn:hover:not(:disabled) {
            background: var(--mc-light);
            transform: translateY(2px);
            box-shadow: 0 3px 0 #219653;
        }

        .convert-btn:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: none;
        }

        .convert-btn:disabled {
            background: #7f8c8d;
            box-shadow: 0 5px 0 #636e72;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .status-box {
            background: rgba(0, 0, 0, 0.5);
            border: 3px solid var(--mc-border);
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            min-height: 100px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 20px;
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--mc-light);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .error-message {
            color: var(--mc-error);
            margin: 15px 0;
            word-break: break-word;
            font-size: 0.8rem;
        }

        .success-message {
            color: var(--mc-light);
            margin: 15px 0;
            font-size: 1rem;
        }

        .download-link {
            display: inline-block;
            margin-top: 15px;
            padding: 12px 25px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
            font-size: 0.9rem;
            border: 2px solid #2980b9;
        }

        .download-link:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--mc-light);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .minecraft-block {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #e74c3c;
            border: 2px solid #c0392b;
            animation: float 15s infinite linear;
            opacity: 0.2;
            z-index: 0;
        }

        .block-2 {
            background: #3498db;
            border-color: #2980b9;
            animation-delay: -5s;
            width: 25px;
            height: 25px;
        }

        .block-3 {
            background: var(--mc-gold);
            border-color: #f39c12;
            animation-delay: -10s;
            width: 35px;
            height: 35px;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.7rem;
            padding-top: 20px;
            border-top: 2px solid var(--mc-border);
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.5rem; }
            .container { padding: 15px; }
            .converter-box { padding: 15px; }
            .format-option { width: 120px; padding: 10px; }
            .upload-area { padding: 25px 10px; }
            .format-selector { gap: 10px; }
        }
    </style>
</head>
<body>
    <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏ -->
    <div class="minecraft-block" style="top:10%;left:5%;"></div>
    <div class="minecraft-block block-2" style="top:20%;left:80%;"></div>
    <div class="minecraft-block block-3" style="top:70%;left:15%;"></div>

    <div class="container">
        <div class="header">
            <h1>LITEMATICA CONVERTER</h1>
            <p class="subtitle">–ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø .LITEMATIC –í .NBT/.SCHEMATIC</p>
            <p class="subtitle">–†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø</p>
        </div>

        <div class="converter-box">
            <div class="upload-area" id="uploadArea">
                <h2>–ü–ï–†–ï–¢–ê–©–ò–¢–ï –§–ê–ô–õ .LITEMATIC</h2>
                <p>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                <p id="fileName"></p>
                <input type="file" id="fileInput" accept=".litematic" hidden>
            </div>

            <div class="format-selector">
                <div class="format-option" data-format="nbt">
                    <div class="format-icon">üß±</div>
                    <h3>.NBT</h3>
                    <p>Minecraft Structure</p>
                </div>
                <div class="format-option" data-format="schematic">
                    <div class="format-icon">üì¶</div>
                    <h3>.SCHEMATIC</h3>
                    <p>Legacy Format</p>
                </div>
            </div>

            <button class="convert-btn" id="convertBtn" disabled>–ö–û–ù–í–ï–†–¢–ò–†–û–í–ê–¢–¨</button>
        </div>

        <div class="status-box">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <p id="statusText">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª .litematic –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</p>
            <div id="errorMessage" class="error-message"></div>
            <div id="successMessage" class="success-message"></div>
            <a id="downloadLink" class="download-link" hidden>–°–∫–∞—á–∞—Ç—å</a>
        </div>
        
        <div class="footer">
            <p>–í–ù–ò–ú–ê–ù–ò–ï: –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–∞</p>
            <p>¬© 2023 Litematica Converter | –ù–µ —Å–≤—è–∑–∞–Ω–æ —Å Mojang –∏–ª–∏ Microsoft</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
            if (typeof pako === 'undefined') {
                showError('–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Pako –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                return;
            }
            
            if (typeof nbt === 'undefined') {
                showError('–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ NBT-JS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                return;
            }
            
            if (typeof litematic === 'undefined') {
                showError('–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Litematic-JS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                return;
            }
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');
            const convertBtn = document.getElementById('convertBtn');
            const statusText = document.getElementById('statusText');
            const progressFill = document.getElementById('progressFill');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const downloadLink = document.getElementById('downloadLink');
            const formatOptions = document.querySelectorAll('.format-option');
            
            let selectedFile = null;
            let selectedFormat = null;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            convertBtn.addEventListener('click', convertFile);
            
            // Drag and drop
            ['dragover', 'dragenter'].forEach(event => {
                uploadArea.addEventListener(event, (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('active');
                });
            });
            
            ['dragleave', 'dragend', 'drop'].forEach(event => {
                uploadArea.addEventListener(event, () => {
                    uploadArea.classList.remove('active');
                });
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                if (e.dataTransfer.files.length) {
                    handleFileSelect({ target: { files: e.dataTransfer.files } });
                }
            });
            
            // –í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedFormat = option.dataset.format;
                    updateConvertButton();
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                errorMessage.textContent = '';
                successMessage.textContent = '';
                downloadLink.hidden = true;
                
                if (file.name.endsWith('.litematic')) {
                    selectedFile = file;
                    fileName.textContent = file.name;
                    statusText.textContent = `–ì–æ—Ç–æ–≤–æ –∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: ${file.name}`;
                    uploadArea.classList.remove('error');
                    updateConvertButton();
                } else {
                    showError('–û—à–∏–±–∫–∞: –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .litematic');
                    uploadArea.classList.add('error');
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏
            function updateConvertButton() {
                convertBtn.disabled = !(selectedFile && selectedFormat);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
            function showError(message) {
                errorMessage.textContent = message;
                statusText.textContent = '–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏';
                progressFill.style.width = '0%';
                successMessage.textContent = '';
                downloadLink.hidden = true;
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—Ö–∞
            function showSuccess(message) {
                successMessage.textContent = message;
                errorMessage.textContent = '';
            }
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
            async function convertFile() {
                if (!selectedFile || !selectedFormat) return;
                
                // –°–±—Ä–æ—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
                downloadLink.hidden = true;
                errorMessage.textContent = '';
                successMessage.textContent = '';
                convertBtn.disabled = true;
                statusText.textContent = '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...';
                progressFill.style.width = '0%';
                
                try {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
                    statusText.innerHTML = '<div class="spinner"></div> –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...';
                    
                    // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
                    const arrayBuffer = await readFile(selectedFile);
                    updateProgress(20);
                    
                    // –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ Litematic
                    const litematicData = litematic.parse(arrayBuffer);
                    updateProgress(50);
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    let resultData;
                    let outputFilename;
                    
                    if (selectedFormat === 'nbt') {
                        resultData = await convertToNBT(litematicData);
                        outputFilename = selectedFile.name.replace('.litematic', '.nbt');
                    } else {
                        resultData = await convertToSchematic(litematicData);
                        outputFilename = selectedFile.name.replace('.litematic', '.schematic');
                    }
                    updateProgress(80);
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                    const blob = new Blob([resultData], {type: 'application/octet-stream'});
                    const url = URL.createObjectURL(blob);
                    
                    downloadLink.href = url;
                    downloadLink.download = outputFilename;
                    downloadLink.textContent = `–°–∫–∞—á–∞—Ç—å ${outputFilename}`;
                    downloadLink.hidden = false;
                    
                    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
                    updateProgress(100);
                    statusText.textContent = '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!';
                    showSuccess('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:', error);
                    showError(`–û—à–∏–±–∫–∞: ${error.message || '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞'}`);
                } finally {
                    convertBtn.disabled = false;
                }
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            function readFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = () => reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
                    reader.readAsArrayBuffer(file);
                });
            }
            
            // –†–µ–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ NBT
            async function convertToNBT(litematicData) {
                return new Promise((resolve) => {
                    // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É NBT
                    const nbtStructure = {
                        name: "Structure",
                        value: {
                            DataVersion: { type: "int", value: litematicData.dataVersion || 2730 },
                            size: {
                                type: "list",
                                value: {
                                    type: "int",
                                    value: [
                                        litematicData.region.width,
                                        litematicData.region.height,
                                        litematicData.region.length
                                    ]
                                }
                            },
                            entities: { type: "list", value: { type: "end", value: [] } },
                            palette: {
                                type: "list",
                                value: {
                                    type: "compound",
                                    value: litematicData.region.palette.map(block => ({
                                        Name: { type: "string", value: block.name },
                                        Properties: block.properties ? {
                                            type: "compound",
                                            value: Object.entries(block.properties).map(([key, val]) => ({
                                                name: key,
                                                value: { type: "string", value: val }
                                            }))
                                        } : undefined
                                    }))
                                }
                            },
                            blocks: {
                                type: "list",
                                value: {
                                    type: "compound",
                                    value: litematicData.region.blockData.map(block => ({
                                        pos: {
                                            type: "list",
                                            value: {
                                                type: "int",
                                                value: [block.x, block.y, block.z]
                                            }
                                        },
                                        state: { type: "int", value: block.state }
                                    }))
                                }
                            }
                        }
                    };
                    
                    // –ö–æ–¥–∏—Ä—É–µ–º –≤ –±–∏–Ω–∞—Ä–Ω—ã–π NBT
                    const encoded = nbt.writeUncompressed(nbtStructure);
                    resolve(encoded);
                });
            }
            
            // –†–µ–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Schematic
            async function convertToSchematic(litematicData) {
                return new Promise((resolve) => {
                    // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É Schematic
                    const schematic = {
                        Width: litematicData.region.width,
                        Height: litematicData.region.height,
                        Length: litematicData.region.length,
                        Materials: "Alpha",
                        Blocks: new Uint8Array(litematicData.region.blockData.length),
                        Data: new Uint8Array(litematicData.region.blockData.length),
                        AddBlocks: null,
                        Entities: [],
                        TileEntities: []
                    };
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–ª–æ–∫–∏
                    litematicData.region.blockData.forEach((block, index) => {
                        schematic.Blocks[index] = block.state;
                    });
                    
                    // –ö–æ–¥–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç Schematic
                    const encoded = nbt.writeUncompressed({
                        name: "Schematic",
                        value: schematic
                    });
                    
                    resolve(encoded);
                });
            }
            
            function updateProgress(percent) {
                progressFill.style.width = `${percent}%`;
            }
        });
    </script>
</body>
</html>
